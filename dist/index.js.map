{"version":3,"file":"index.js","sources":["../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.js"],"sourcesContent":["var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import \"./index.styl\"\n\nexport default class Quote {\n  rootClass = 'editor-js-quote-plugin';\n  caption = null;\n  text = null;\n  image = null;\n  post = null;\n  headers = {};\n  uploadFileName = 'file';\n  imageLoading = false;\n  endpoint = '/';\n\n  constructor({data, api, config}){\n    this.caption = data.caption;\n    this.post = data.post;\n    this.text = data.text;\n    this.image = data.image;\n    this.api = api;\n    if (config) {\n      if (config.headers) {\n        this.headers = config.headers;\n      }\n      if (config.endpoint) {\n        this.endpoint = config.endpoint;\n      }\n      if (config.uploadFileName) {\n        this.uploadFileName = config.uploadFileName;\n      }\n    }\n  }\n\n  render(){\n    this.root = document.createElement('div');\n    this.root.classList.add(this.rootClass);\n    this.root.classList.add('cdx-block');\n    this.redraw();\n    return this.root;\n  }\n\n  async handleFileUpload(e) {\n    if (e.target.files[0]) {\n      let fd = new FormData();\n      fd.append(this.uploadFileName, e.target.files[0])\n\n      let data = await fetch(this.endpoint, {\n        method: 'POST',\n        headers: this.headers,\n        body: fd\n      }).then((res) => res.json());\n      return data.file\n    }\n  }\n\n  redraw() {\n    let image = '';\n    if (this.image) {\n      image = `<div class=\"${this.rootClass}__image\">\n        <img src=\"${this.image}\" alt=\"\" />\n        <button type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z\"/></svg></button>\n      </div>`\n    } else {\n      image = `<label class=\"${this.rootClass}__image-input ${this.imageLoading ? 'cdx-loader' : ''}\">\n        <input type=\"file\" accept=\"image/*\" />\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M4.828 21l-.02.02-.021-.02H2.992A.993.993 0 0 1 2 20.007V3.993A1 1 0 0 1 2.992 3h18.016c.548 0 .992.445.992.993v16.014a1 1 0 0 1-.992.993H4.828zM20 15V5H4v14L14 9l6 6zm0 2.828l-6-6L6.828 19H20v-1.172zM8 11a2 2 0 1 1 0-4 2 2 0 0 1 0 4z\"/></svg>\n        <span>Загрузить изображение</span>\n      </label>`\n    }\n    let author = `<div class=\"${this.rootClass}__author\">\n      <input type=\"text\" class=\"cdx-input\" value=\"${this.caption || ''}\" placeholder=\"Персона\">\n      <input type=\"text\" class=\"cdx-input\" value=\"${this.post || ''}\" placeholder=\"Должность\">\n    </div>`;\n    let header = `<div class=\"${this.rootClass}__header\">${image}${author}</div>`;\n    this.root.innerHTML = `${header}<textarea placeholder=\"Цитата\" rows=\"5\" class=\"cdx-input\">${this.text || ''}</textarea>`\n\n    this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__author input:first-child`), 'input', (e) => {\n      this.caption = e.target.value;\n    }, false);\n    this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__author input:last-child`), 'input', (e) => {\n      this.post = e.target.value;\n    }, false);\n    this.api.listeners.on(this.root.querySelector(`.${this.rootClass} textarea`), 'input', (e) => {\n      this.text = e.target.value;\n    }, false);\n\n    if (this.image) {\n      this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__image button`), 'click', () => {\n        if (confirm(\"Вы уверены?\")) {\n          this.image = null;\n          this.redraw();\n        }\n      }, false);\n    } else {\n      this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__image-input input`), 'input', (e) => {\n        this.imageLoading = true;\n        this.handleFileUpload(e).then((file) => {\n          this.image = file;\n        }).catch((e) => {\n          console.error(e.message)\n        }).finally(() => {\n          this.imageLoading = false;\n          this.redraw();\n        })\n      }, false);\n    }\n  }\n\n  save(){\n    return {\n      post: this.post,\n      image: this.image,\n      caption: this.caption,\n      text: this.text,\n    };\n  }\n\n  static get toolbox() {\n    return {\n      title: 'Цитата',\n      icon: '<svg width=\"15\" height=\"14\" viewBox=\"0 0 15 14\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M13.53 6.185l.027.025a1.109 1.109 0 0 1 0 1.568l-5.644 5.644a1.109 1.109 0 1 1-1.569-1.568l4.838-4.837L6.396 2.23A1.125 1.125 0 1 1 7.986.64l5.52 5.518.025.027zm-5.815 0l.026.025a1.109 1.109 0 0 1 0 1.568l-5.644 5.644a1.109 1.109 0 1 1-1.568-1.568l4.837-4.837L.58 2.23A1.125 1.125 0 0 1 2.171.64L7.69 6.158l.025.027z\"></path></svg>'\n    };\n  }\n}"],"names":["e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","Object","keys","length","insertAdjacentElement","Quote","rootClass","caption","text","image","post","headers","uploadFileName","imageLoading","endpoint","constructor","data","api","config","this","render","root","classList","add","redraw","async","target","files","fd","FormData","append","fetch","method","body","then","res","json","file","author","header","innerHTML","listeners","on","value","confirm","handleFileUpload","catch","console","error","message","finally","save","toolbox","title","icon"],"mappings":"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"}